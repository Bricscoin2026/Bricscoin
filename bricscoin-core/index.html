<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>BricsCoin Core</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{
  font-family:'Segoe UI',system-ui,-apple-system,sans-serif;
  background:#000;
  color:#fff;
  min-height:100vh;
  overflow-x:hidden;
}

/* Matrix Canvas Background */
#matrix-bg{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  z-index:0;
  opacity:0.5;
}

/* Mining Particles Canvas */
#mining-particles{
  position:fixed;
  top:0;left:0;
  width:100%;height:100%;
  z-index:1;
  pointer-events:none;
  opacity:0;
  transition:opacity 0.5s ease;
}
#mining-particles.active{
  opacity:1;
}

/* Main container */
.app{
  position:relative;
  z-index:2;
  min-height:100vh;
  background:radial-gradient(ellipse at top, rgba(0,30,0,0.3) 0%, transparent 50%),
              radial-gradient(ellipse at bottom, rgba(0,20,0,0.2) 0%, transparent 50%);
}

.container{max-width:1200px;margin:0 auto;padding:20px 30px}

/* Header */
.header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:20px 0;
  border-bottom:1px solid rgba(0,255,0,0.15);
  margin-bottom:25px;
}
.logo-section{display:flex;align-items:center;gap:18px}
.logo-img{
  width:65px;height:65px;
  border-radius:50%;
  border:2px solid rgba(0,255,0,0.4);
  box-shadow:0 0 25px rgba(0,255,0,0.3), 0 0 50px rgba(0,255,0,0.15);
  animation:logoPulse 3s ease-in-out infinite;
}
@keyframes logoPulse{
  0%,100%{box-shadow:0 0 25px rgba(0,255,0,0.3), 0 0 50px rgba(0,255,0,0.15)}
  50%{box-shadow:0 0 35px rgba(0,255,0,0.5), 0 0 70px rgba(0,255,0,0.25)}
}
.logo-text h1{
  font-size:28px;
  font-weight:700;
  background:linear-gradient(135deg,#00ff00 0%,#00cc00 50%,#00ff44 100%);
  -webkit-background-clip:text;
  -webkit-text-fill-color:transparent;
  text-shadow:0 0 40px rgba(0,255,0,0.4);
  letter-spacing:1px;
}
.logo-text span{color:rgba(255,255,255,0.4);font-size:12px;letter-spacing:2px}

.connection-status{
  display:flex;
  align-items:center;
  gap:10px;
  padding:10px 20px;
  background:rgba(0,255,0,0.08);
  border:1px solid rgba(0,255,0,0.2);
  border-radius:30px;
}
.status-dot{
  width:10px;height:10px;
  border-radius:50%;
  background:#00ff00;
  box-shadow:0 0 10px #00ff00, 0 0 20px #00ff00;
  animation:blink 2s infinite;
}
@keyframes blink{0%,100%{opacity:1}50%{opacity:0.5}}
.connection-status span{color:#00ff00;font-size:13px;font-weight:500}

/* Network Stats Grid */
.stats-grid{
  display:grid;
  grid-template-columns:repeat(4,1fr);
  gap:18px;
  margin-bottom:25px;
}
.stat-card{
  background:linear-gradient(135deg,rgba(0,50,0,0.4) 0%,rgba(0,30,0,0.2) 100%);
  border:1px solid rgba(0,255,0,0.15);
  border-radius:16px;
  padding:22px;
  text-align:center;
  transition:all 0.3s ease;
  position:relative;
  overflow:hidden;
}
.stat-card::before{
  content:'';
  position:absolute;
  top:0;left:-100%;
  width:100%;height:100%;
  background:linear-gradient(90deg,transparent,rgba(0,255,0,0.05),transparent);
  transition:0.5s;
}
.stat-card:hover::before{left:100%}
.stat-card:hover{
  transform:translateY(-3px);
  border-color:rgba(0,255,0,0.3);
  box-shadow:0 10px 40px rgba(0,255,0,0.1);
}
.stat-value{
  font-size:30px;
  font-weight:bold;
  color:#00ff00;
  text-shadow:0 0 20px rgba(0,255,0,0.4);
  font-family:'Courier New',monospace;
}
.stat-label{
  font-size:11px;
  color:rgba(255,255,255,0.5);
  text-transform:uppercase;
  letter-spacing:2px;
  margin-top:8px;
}

/* Navigation Tabs */
.nav-tabs{
  display:flex;
  gap:8px;
  margin-bottom:25px;
  background:rgba(0,20,0,0.4);
  padding:8px;
  border-radius:16px;
  border:1px solid rgba(0,255,0,0.1);
}
.nav-tab{
  flex:1;
  padding:14px 24px;
  background:transparent;
  border:none;
  border-radius:10px;
  color:rgba(255,255,255,0.6);
  cursor:pointer;
  transition:all 0.3s ease;
  font-size:14px;
  font-weight:600;
  display:flex;
  align-items:center;
  justify-content:center;
  gap:8px;
}
.nav-tab:hover{background:rgba(0,255,0,0.08);color:rgba(255,255,255,0.9)}
.nav-tab.active{
  background:linear-gradient(135deg,rgba(0,255,0,0.2) 0%,rgba(0,180,0,0.15) 100%);
  color:#00ff00;
  box-shadow:0 0 20px rgba(0,255,0,0.15);
  border:1px solid rgba(0,255,0,0.3);
}
.nav-tab svg{width:18px;height:18px}

/* Cards */
.card{
  background:linear-gradient(180deg,rgba(0,40,0,0.35) 0%,rgba(0,20,0,0.25) 100%);
  border:1px solid rgba(0,255,0,0.12);
  border-radius:20px;
  padding:28px;
  margin-bottom:20px;
  backdrop-filter:blur(10px);
  position:relative;
  overflow:hidden;
}
.card::after{
  content:'';
  position:absolute;
  top:0;left:0;right:0;
  height:1px;
  background:linear-gradient(90deg,transparent,rgba(0,255,0,0.3),transparent);
}
.card-header{
  display:flex;
  align-items:center;
  gap:12px;
  margin-bottom:22px;
  padding-bottom:15px;
  border-bottom:1px solid rgba(0,255,0,0.1);
}
.card-icon{
  width:40px;height:40px;
  background:linear-gradient(135deg,rgba(0,255,0,0.2),rgba(0,180,0,0.1));
  border-radius:12px;
  display:flex;align-items:center;justify-content:center;
  color:#00ff00;
  font-size:18px;
}
.card-title{
  font-size:18px;
  font-weight:600;
  color:#fff;
}

/* Forms */
.form-group{margin-bottom:16px}
.form-label{
  display:block;
  font-size:12px;
  color:rgba(255,255,255,0.5);
  text-transform:uppercase;
  letter-spacing:1px;
  margin-bottom:8px;
}
input,select{
  width:100%;
  padding:16px 20px;
  background:rgba(0,0,0,0.4);
  border:1px solid rgba(0,255,0,0.15);
  border-radius:12px;
  color:#fff;
  font-size:14px;
  transition:all 0.3s ease;
  font-family:inherit;
}
input:focus,select:focus{
  outline:none;
  border-color:#00ff00;
  box-shadow:0 0 20px rgba(0,255,0,0.15), inset 0 0 20px rgba(0,255,0,0.05);
}
input::placeholder{color:rgba(255,255,255,0.3)}
select{cursor:pointer}
select option{background:#0a0a0a;color:#fff}

/* Buttons */
.btn{
  display:inline-flex;
  align-items:center;
  justify-content:center;
  gap:10px;
  padding:16px 32px;
  border:none;
  border-radius:12px;
  font-size:14px;
  font-weight:600;
  cursor:pointer;
  transition:all 0.3s ease;
  font-family:inherit;
}
.btn-primary{
  background:linear-gradient(135deg,#00ff00 0%,#00cc00 100%);
  color:#000;
  box-shadow:0 4px 20px rgba(0,255,0,0.3);
}
.btn-primary:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 30px rgba(0,255,0,0.4);
}
.btn-secondary{
  background:rgba(0,255,0,0.1);
  color:#00ff00;
  border:1px solid rgba(0,255,0,0.3);
}
.btn-secondary:hover{
  background:rgba(0,255,0,0.2);
}
.btn-danger{
  background:linear-gradient(135deg,#ff3333 0%,#cc0000 100%);
  color:#fff;
  box-shadow:0 4px 20px rgba(255,0,0,0.3);
}
.btn-danger:hover{
  transform:translateY(-2px);
  box-shadow:0 8px 30px rgba(255,0,0,0.4);
}

/* Wallet Cards */
.wallet-list{display:flex;flex-direction:column;gap:15px}
.wallet-card{
  background:linear-gradient(135deg,rgba(0,50,0,0.3) 0%,rgba(0,30,0,0.2) 100%);
  border:1px solid rgba(0,255,0,0.15);
  border-radius:16px;
  padding:22px;
  transition:all 0.3s ease;
}
.wallet-card:hover{
  border-color:rgba(0,255,0,0.35);
  box-shadow:0 0 30px rgba(0,255,0,0.1);
}
.wallet-header{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:15px;
}
.wallet-name{
  font-size:18px;
  font-weight:600;
  color:#fff;
}
.wallet-balance{
  font-size:24px;
  font-weight:bold;
  color:#00ff00;
  text-shadow:0 0 15px rgba(0,255,0,0.4);
}
.wallet-balance span{font-size:14px;color:rgba(0,255,0,0.7)}
.wallet-address{
  font-family:'Courier New',monospace;
  font-size:12px;
  color:#00ff00;
  background:rgba(0,0,0,0.4);
  padding:12px 16px;
  border-radius:10px;
  word-break:break-all;
  border:1px solid rgba(0,255,0,0.1);
}
.wallet-seed{
  margin-top:12px;
  font-family:'Courier New',monospace;
  font-size:11px;
  color:#ff6666;
  background:rgba(255,0,0,0.08);
  padding:12px 16px;
  border-radius:10px;
  border:1px solid rgba(255,0,0,0.2);
}
.wallet-seed::before{
  content:'‚ö†Ô∏è SEED PHRASE: ';
  font-weight:bold;
}
.empty-state{
  text-align:center;
  padding:50px 20px;
  color:rgba(255,255,255,0.4);
}
.empty-state svg{
  width:60px;height:60px;
  margin-bottom:15px;
  opacity:0.3;
}

/* Mining Section */
.mining-stats{
  display:grid;
  grid-template-columns:repeat(3,1fr);
  gap:15px;
  margin:20px 0;
}
.mining-stat{
  background:rgba(0,0,0,0.4);
  border:1px solid rgba(0,255,0,0.1);
  border-radius:14px;
  padding:22px;
  text-align:center;
  transition:all 0.3s ease;
}
.mining-stat.active{
  border-color:rgba(0,255,0,0.4);
  box-shadow:0 0 20px rgba(0,255,0,0.1);
}
.mining-stat-value{
  font-size:28px;
  font-weight:bold;
  color:#00ff00;
  font-family:'Courier New',monospace;
  text-shadow:0 0 15px rgba(0,255,0,0.4);
}
.mining-stat-label{
  font-size:11px;
  color:rgba(255,255,255,0.4);
  text-transform:uppercase;
  letter-spacing:1px;
  margin-top:8px;
}

/* Mining Animation Container */
.mining-animation{
  position:relative;
  height:120px;
  background:rgba(0,0,0,0.4);
  border:1px solid rgba(0,255,0,0.15);
  border-radius:16px;
  margin:20px 0;
  overflow:hidden;
  display:flex;
  align-items:center;
  justify-content:center;
}
.mining-animation.active{
  border-color:rgba(0,255,0,0.4);
}
.mining-animation canvas{
  position:absolute;
  top:0;left:0;
  width:100%;height:100%;
}
.mining-status-text{
  position:relative;
  z-index:1;
  font-family:'Courier New',monospace;
  font-size:14px;
  color:rgba(255,255,255,0.5);
  text-align:center;
  padding:20px;
}
.mining-status-text.active{
  color:#00ff00;
  text-shadow:0 0 10px rgba(0,255,0,0.5);
}
.mining-status-text .icon{
  font-size:32px;
  display:block;
  margin-bottom:10px;
  animation:bounce 1s ease-in-out infinite;
}
@keyframes bounce{
  0%,100%{transform:translateY(0)}
  50%{transform:translateY(-5px)}
}

.mining-buttons{display:flex;gap:12px;margin-top:20px}

/* Blocks Table */
.blocks-table{width:100%;border-collapse:collapse}
.blocks-table th{
  padding:14px 16px;
  text-align:left;
  font-size:11px;
  text-transform:uppercase;
  letter-spacing:1px;
  color:rgba(255,255,255,0.4);
  border-bottom:1px solid rgba(0,255,0,0.1);
}
.blocks-table td{
  padding:16px;
  border-bottom:1px solid rgba(0,255,0,0.05);
  font-family:'Courier New',monospace;
  font-size:13px;
}
.blocks-table tr:hover td{background:rgba(0,255,0,0.03)}
.block-height{
  color:#00ff00;
  font-weight:bold;
  text-shadow:0 0 10px rgba(0,255,0,0.3);
}
.block-hash{color:rgba(255,255,255,0.6)}
.block-miner{color:rgba(0,255,0,0.7)}
.block-time{color:rgba(255,255,255,0.4)}

/* Toast Notifications */
#toast{
  position:fixed;
  bottom:30px;
  right:30px;
  background:linear-gradient(135deg,#00ff00,#00cc00);
  color:#000;
  padding:18px 30px;
  border-radius:14px;
  font-weight:600;
  display:none;
  box-shadow:0 10px 50px rgba(0,255,0,0.4);
  animation:slideInToast 0.4s ease;
  z-index:1000;
}
@keyframes slideInToast{
  from{transform:translateX(120%);opacity:0}
  to{transform:translateX(0);opacity:1}
}
#toast.error{
  background:linear-gradient(135deg,#ff4444,#cc0000);
  color:#fff;
  box-shadow:0 10px 50px rgba(255,0,0,0.4);
}
#toast.success{
  background:linear-gradient(135deg,#FFD700,#FFA500);
  color:#000;
  box-shadow:0 10px 50px rgba(255,215,0,0.5);
  font-size:16px;
}

/* Page visibility */
.page{display:none}
.page.active{display:block}

/* Version footer */
.version-footer{
  text-align:center;
  padding:20px;
  color:rgba(255,255,255,0.2);
  font-size:11px;
  letter-spacing:1px;
}
</style>
</head>
<body>

<canvas id="matrix-bg"></canvas>
<canvas id="mining-particles"></canvas>

<div class="app">
<div class="container">

<!-- Header -->
<header class="header">
  <div class="logo-section">
    <img src="https://bricscoin26.org/bricscoin-logo.png" alt="BricsCoin" class="logo-img" onerror="this.style.display='none'">
    <div class="logo-text">
      <h1>BRICSCOIN CORE</h1>
      <span>FULL NODE WALLET v1.2</span>
    </div>
  </div>
  <div class="connection-status">
    <div class="status-dot"></div>
    <span>Connected to Network</span>
  </div>
</header>

<!-- Network Stats -->
<div class="stats-grid">
  <div class="stat-card">
    <div class="stat-value" id="stat-supply">-</div>
    <div class="stat-label">Circulating Supply</div>
  </div>
  <div class="stat-card">
    <div class="stat-value" id="stat-blocks">-</div>
    <div class="stat-label">Block Height</div>
  </div>
  <div class="stat-card">
    <div class="stat-value" id="stat-difficulty">-</div>
    <div class="stat-label">Difficulty</div>
  </div>
  <div class="stat-card">
    <div class="stat-value" id="stat-reward">50</div>
    <div class="stat-label">Block Reward</div>
  </div>
</div>

<!-- Navigation -->
<nav class="nav-tabs">
  <button class="nav-tab active" onclick="switchTab(0)" data-testid="tab-wallet">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M2 10h20"/><path d="M6 16h4"/></svg>
    Wallet
  </button>
  <button class="nav-tab" onclick="switchTab(1)" data-testid="tab-mining">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>
    Mining
  </button>
  <button class="nav-tab" onclick="switchTab(2)" data-testid="tab-blocks">
    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="3" width="7" height="7"/><rect x="14" y="3" width="7" height="7"/><rect x="14" y="14" width="7" height="7"/><rect x="3" y="14" width="7" height="7"/></svg>
    Blocks
  </button>
</nav>

<!-- WALLET PAGE -->
<div id="page-0" class="page active">
  
  <!-- Create Wallet -->
  <div class="card">
    <div class="card-header">
      <div class="card-icon">+</div>
      <div class="card-title">Create New Wallet</div>
    </div>
    <div class="form-group">
      <label class="form-label">Wallet Name</label>
      <input type="text" id="new-wallet-name" placeholder="Enter a name for your wallet..." data-testid="input-wallet-name">
    </div>
    <button class="btn btn-primary" id="btn-create-wallet" data-testid="btn-create-wallet">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M12 5v14M5 12h14"/></svg>
      Create Wallet
    </button>
  </div>

  <!-- Wallet List -->
  <div class="card">
    <div class="card-header">
      <div class="card-icon">‚óÜ</div>
      <div class="card-title">Your Wallets</div>
    </div>
    <div id="wallet-list" class="wallet-list">
      <div class="empty-state">
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M2 10h20"/></svg>
        <p>No wallets yet. Create your first wallet above!</p>
      </div>
    </div>
  </div>

  <!-- Send Transaction -->
  <div class="card">
    <div class="card-header">
      <div class="card-icon">‚Üí</div>
      <div class="card-title">Send BRICS</div>
    </div>
    <div class="form-group">
      <label class="form-label">From Wallet</label>
      <select id="send-from" data-testid="select-send-from">
        <option value="">Select wallet...</option>
      </select>
    </div>
    <div class="form-group">
      <label class="form-label">Recipient Address</label>
      <input type="text" id="send-to" placeholder="BRICS..." data-testid="input-send-to">
    </div>
    <div class="form-group">
      <label class="form-label">Amount</label>
      <input type="number" id="send-amount" placeholder="0.00" step="0.01" data-testid="input-send-amount">
    </div>
    <button class="btn btn-primary" onclick="sendTransaction()" data-testid="btn-send">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/></svg>
      Send Transaction
    </button>
  </div>
</div>

<!-- MINING PAGE -->
<div id="page-1" class="page">
  <div class="card">
    <div class="card-header">
      <div class="card-icon">‚õè</div>
      <div class="card-title">Mining Control</div>
    </div>
    
    <div class="form-group">
      <label class="form-label">Mining Reward Address</label>
      <select id="mining-wallet" data-testid="select-mining-wallet">
        <option value="">Select wallet for mining rewards...</option>
      </select>
    </div>

    <div class="mining-stats">
      <div class="mining-stat" id="stat-hashrate-card">
        <div class="mining-stat-value" id="mining-hashrate">0</div>
        <div class="mining-stat-label">Hashrate (H/s)</div>
      </div>
      <div class="mining-stat" id="stat-nonce-card">
        <div class="mining-stat-value" id="mining-nonce">0</div>
        <div class="mining-stat-label">Current Nonce</div>
      </div>
      <div class="mining-stat" id="stat-found-card">
        <div class="mining-stat-value" id="mining-found">0</div>
        <div class="mining-stat-label">Blocks Found</div>
      </div>
    </div>

    <!-- Mining Animation Area -->
    <div class="mining-animation" id="mining-animation">
      <canvas id="particle-canvas"></canvas>
      <div class="mining-status-text" id="mining-status">
        <span class="icon">‚õèÔ∏è</span>
        Ready to mine. Select a wallet and click Start Mining.
      </div>
    </div>

    <div class="mining-buttons">
      <button class="btn btn-primary" id="btn-start-mining" onclick="startMining()" data-testid="btn-start-mining">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><polygon points="5 3 19 12 5 21 5 3"/></svg>
        Start Mining
      </button>
      <button class="btn btn-danger" id="btn-stop-mining" onclick="stopMining()" style="display:none" data-testid="btn-stop-mining">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor"><rect x="6" y="6" width="12" height="12"/></svg>
        Stop Mining
      </button>
    </div>
  </div>
</div>

<!-- BLOCKS PAGE -->
<div id="page-2" class="page">
  <div class="card">
    <div class="card-header">
      <div class="card-icon">‚ñ£</div>
      <div class="card-title">Recent Blocks</div>
    </div>
    <table class="blocks-table">
      <thead>
        <tr>
          <th>Height</th>
          <th>Hash</th>
          <th>Miner</th>
          <th>Time</th>
        </tr>
      </thead>
      <tbody id="blocks-table-body">
        <tr><td colspan="4" style="text-align:center;color:rgba(255,255,255,0.3);padding:30px">Loading blocks...</td></tr>
      </tbody>
    </table>
  </div>
</div>

<div class="version-footer">
  BRICSCOIN CORE v1.2 ‚Ä¢ Powered by BricsCoin Network
</div>

</div>
</div>

<div id="toast"></div>

<script>
// ==================== MATRIX BACKGROUND ====================
(function initMatrix() {
  const canvas = document.getElementById('matrix-bg');
  const ctx = canvas.getContext('2d');
  
  function resize() {
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
  }
  resize();
  window.addEventListener('resize', resize);

  const chars = '0123456789ABCDEFabcdef‚ÇøŒ£ŒîŒ©‚óÜ‚ñ£';
  const charArray = chars.split('');
  const fontSize = 14;
  let columns = Math.floor(canvas.width / fontSize);
  let drops = [];
  
  for (let i = 0; i < columns; i++) {
    drops[i] = Math.random() * -100;
  }

  function draw() {
    ctx.fillStyle = 'rgba(0, 0, 0, 0.05)';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.font = fontSize + 'px monospace';

    for (let i = 0; i < drops.length; i++) {
      const char = charArray[Math.floor(Math.random() * charArray.length)];
      const x = i * fontSize;
      const y = drops[i] * fontSize;

      if (Math.random() > 0.98) {
        ctx.fillStyle = '#FFD700';
      } else {
        ctx.fillStyle = 'rgba(0, ' + (150 + Math.random() * 105) + ', 0, ' + (0.3 + Math.random() * 0.5) + ')';
      }
      
      ctx.fillText(char, x, y);

      if (y > canvas.height && Math.random() > 0.975) {
        drops[i] = 0;
      }
      drops[i]++;
    }
  }

  setInterval(draw, 50);

  window.addEventListener('resize', () => {
    columns = Math.floor(canvas.width / fontSize);
    drops = [];
    for (let i = 0; i < columns; i++) {
      drops[i] = Math.random() * -100;
    }
  });
})();

// ==================== MINING PARTICLE ANIMATION ====================
const MiningParticles = (function() {
  const canvas = document.getElementById('particle-canvas');
  const ctx = canvas.getContext('2d');
  let particles = [];
  let animationId = null;
  let isActive = false;

  function resize() {
    const container = canvas.parentElement;
    canvas.width = container.offsetWidth;
    canvas.height = container.offsetHeight;
  }

  class Particle {
    constructor() {
      this.reset();
    }

    reset() {
      this.x = Math.random() * canvas.width;
      this.y = canvas.height + 10;
      this.size = Math.random() * 4 + 2;
      this.speedY = -(Math.random() * 2 + 1);
      this.speedX = (Math.random() - 0.5) * 2;
      this.opacity = Math.random() * 0.8 + 0.2;
      this.color = Math.random() > 0.3 ? '#00ff00' : '#FFD700';
      this.life = 1;
      this.decay = Math.random() * 0.01 + 0.005;
    }

    update() {
      this.y += this.speedY;
      this.x += this.speedX;
      this.life -= this.decay;
      
      // Add some waviness
      this.x += Math.sin(this.y * 0.02) * 0.5;

      if (this.life <= 0 || this.y < -10) {
        this.reset();
      }
    }

    draw() {
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
      ctx.fillStyle = this.color;
      ctx.globalAlpha = this.opacity * this.life;
      ctx.fill();
      ctx.globalAlpha = 1;

      // Glow effect
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.size * 2, 0, Math.PI * 2);
      const gradient = ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size * 2);
      gradient.addColorStop(0, this.color + '40');
      gradient.addColorStop(1, 'transparent');
      ctx.fillStyle = gradient;
      ctx.globalAlpha = this.opacity * this.life * 0.5;
      ctx.fill();
      ctx.globalAlpha = 1;
    }
  }

  function init() {
    resize();
    particles = [];
    for (let i = 0; i < 50; i++) {
      const p = new Particle();
      p.y = Math.random() * canvas.height;
      particles.push(p);
    }
  }

  function animate() {
    if (!isActive) return;
    
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    
    particles.forEach(p => {
      p.update();
      p.draw();
    });

    // Draw connecting lines between close particles
    ctx.strokeStyle = 'rgba(0, 255, 0, 0.1)';
    ctx.lineWidth = 1;
    for (let i = 0; i < particles.length; i++) {
      for (let j = i + 1; j < particles.length; j++) {
        const dx = particles[i].x - particles[j].x;
        const dy = particles[i].y - particles[j].y;
        const dist = Math.sqrt(dx * dx + dy * dy);
        if (dist < 80) {
          ctx.globalAlpha = (1 - dist / 80) * 0.3;
          ctx.beginPath();
          ctx.moveTo(particles[i].x, particles[i].y);
          ctx.lineTo(particles[j].x, particles[j].y);
          ctx.stroke();
        }
      }
    }
    ctx.globalAlpha = 1;

    animationId = requestAnimationFrame(animate);
  }

  function start() {
    if (isActive) return;
    isActive = true;
    init();
    animate();
    document.getElementById('mining-animation').classList.add('active');
    document.getElementById('mining-particles').classList.add('active');
  }

  function stop() {
    isActive = false;
    if (animationId) {
      cancelAnimationFrame(animationId);
      animationId = null;
    }
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    document.getElementById('mining-animation').classList.remove('active');
    document.getElementById('mining-particles').classList.remove('active');
  }

  window.addEventListener('resize', () => {
    if (isActive) {
      resize();
    }
  });

  return { start, stop };
})();

// ==================== APP STATE ====================
let blocksFound = 0;
let isMining = false;

// ==================== TAB NAVIGATION ====================
function switchTab(index) {
  document.querySelectorAll('.nav-tab').forEach((tab, i) => {
    tab.classList.toggle('active', i === index);
  });
  document.querySelectorAll('.page').forEach((page, i) => {
    page.classList.toggle('active', i === index);
  });
}

// ==================== TOAST NOTIFICATIONS ====================
function showToast(message, type = 'normal') {
  const toast = document.getElementById('toast');
  toast.textContent = message;
  toast.className = type;
  toast.style.display = 'block';
  setTimeout(() => { toast.style.display = 'none'; }, type === 'success' ? 6000 : 4000);
}

// ==================== NETWORK FUNCTIONS ====================
async function loadStats() {
  try {
    const stats = await window.bc.stats();
    if (stats) {
      document.getElementById('stat-supply').textContent = (stats.circulating_supply || 0).toLocaleString();
      document.getElementById('stat-blocks').textContent = (stats.total_blocks || 0).toLocaleString();
      document.getElementById('stat-difficulty').textContent = stats.current_difficulty || 0;
      document.getElementById('stat-reward').textContent = stats.current_reward || 50;
    }
  } catch (e) {
    console.error('Error loading stats:', e);
  }
}

async function loadBlocks() {
  try {
    const blocks = await window.bc.blocks();
    const tbody = document.getElementById('blocks-table-body');
    
    if (!blocks || blocks.length === 0) {
      tbody.innerHTML = '<tr><td colspan="4" style="text-align:center;color:rgba(255,255,255,0.3);padding:30px">No blocks found</td></tr>';
      return;
    }
    
    tbody.innerHTML = blocks.map(block => `
      <tr>
        <td class="block-height">#${block.index}</td>
        <td class="block-hash">${(block.hash || '').slice(0, 20)}...</td>
        <td class="block-miner">${(block.miner || 'Unknown').slice(0, 16)}...</td>
        <td class="block-time">${new Date(block.timestamp).toLocaleString()}</td>
      </tr>
    `).join('');
  } catch (e) {
    console.error('Error loading blocks:', e);
  }
}

async function loadWallets() {
  try {
    const wallets = await window.bc.wallets();
    const listEl = document.getElementById('wallet-list');
    const sendSelect = document.getElementById('send-from');
    const miningSelect = document.getElementById('mining-wallet');
    
    sendSelect.innerHTML = '<option value="">Select wallet...</option>';
    miningSelect.innerHTML = '<option value="">Select wallet for mining rewards...</option>';
    
    if (!wallets || wallets.length === 0) {
      listEl.innerHTML = `
        <div class="empty-state">
          <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1"><rect x="2" y="4" width="20" height="16" rx="2"/><path d="M2 10h20"/></svg>
          <p>No wallets yet. Create your first wallet above!</p>
        </div>
      `;
      return;
    }
    
    listEl.innerHTML = wallets.map(w => `
      <div class="wallet-card">
        <div class="wallet-header">
          <div class="wallet-name">${w.name}</div>
          <div class="wallet-balance">${(w.balance || 0).toLocaleString()} <span>BRICS</span></div>
        </div>
        <div class="wallet-address">${w.address}</div>
        <div class="wallet-seed">${w.seedPhrase}</div>
      </div>
    `).join('');
    
    wallets.forEach(w => {
      sendSelect.innerHTML += `<option value="${w.address}">${w.name} (${(w.balance || 0)} BRICS)</option>`;
      miningSelect.innerHTML += `<option value="${w.address}">${w.name}</option>`;
    });
  } catch (e) {
    console.error('Error loading wallets:', e);
  }
}

// ==================== WALLET FUNCTIONS ====================
async function createWallet() {
  const nameInput = document.getElementById('new-wallet-name');
  const name = nameInput.value.trim() || 'My Wallet';
  
  try {
    await window.bc.newwallet(name);
    showToast('‚úÖ Wallet "' + name + '" created successfully!');
    nameInput.value = '';
    loadWallets();
  } catch (e) {
    showToast('‚ùå Error: ' + e.message, 'error');
  }
}

async function sendTransaction() {
  const from = document.getElementById('send-from').value;
  const to = document.getElementById('send-to').value;
  const amount = document.getElementById('send-amount').value;
  
  if (!from || !to || !amount) {
    showToast('‚ö†Ô∏è Please fill all fields', 'error');
    return;
  }
  
  try {
    await window.bc.send(from, to, amount);
    showToast('‚úÖ Transaction sent successfully!');
    document.getElementById('send-to').value = '';
    document.getElementById('send-amount').value = '';
    loadWallets();
  } catch (e) {
    showToast('‚ùå Error: ' + e.message, 'error');
  }
}

// ==================== MINING FUNCTIONS ====================
async function startMining() {
  const wallet = document.getElementById('mining-wallet').value;
  if (!wallet) {
    showToast('‚ö†Ô∏è Please select a wallet for mining rewards', 'error');
    return;
  }
  
  isMining = true;
  await window.bc.mine(wallet);
  
  document.getElementById('btn-start-mining').style.display = 'none';
  document.getElementById('btn-stop-mining').style.display = 'inline-flex';
  
  // Activate mining animation
  MiningParticles.start();
  
  // Update UI
  document.querySelectorAll('.mining-stat').forEach(el => el.classList.add('active'));
  
  const status = document.getElementById('mining-status');
  status.className = 'mining-status-text active';
  status.innerHTML = '<span class="icon">‚õèÔ∏è</span>Mining in progress...';
}

async function stopMining() {
  isMining = false;
  await window.bc.stopmine();
  
  document.getElementById('btn-start-mining').style.display = 'inline-flex';
  document.getElementById('btn-stop-mining').style.display = 'none';
  
  // Stop animation
  MiningParticles.stop();
  
  // Update UI
  document.querySelectorAll('.mining-stat').forEach(el => el.classList.remove('active'));
  
  const status = document.getElementById('mining-status');
  status.className = 'mining-status-text';
  status.innerHTML = '<span class="icon">‚èπÔ∏è</span>Mining stopped.';
}

// ==================== MINING EVENTS ====================
// Only update stats silently - no console messages
window.bc.on('minfo', data => {
  // Silent - no message displayed
});

window.bc.on('mprog', data => {
  // Update stats only
  document.getElementById('mining-hashrate').textContent = data.hr.toLocaleString();
  document.getElementById('mining-nonce').textContent = data.n.toLocaleString();
});

// ONLY show message when block is FOUND!
window.bc.on('found', data => {
  blocksFound++;
  document.getElementById('mining-found').textContent = blocksFound;
  
  // Big celebration toast
  showToast('üéâ BLOCK #' + data.block + ' FOUND! +50 BRICS reward!', 'success');
  
  // Update status text
  const status = document.getElementById('mining-status');
  status.innerHTML = '<span class="icon">üéâ</span>Block #' + data.block + ' found! Mining next block...';
  
  // Refresh data
  loadStats();
  loadBlocks();
  loadWallets();
});

// ==================== INITIALIZATION ====================
document.getElementById('btn-create-wallet').addEventListener('click', createWallet);

document.getElementById('new-wallet-name').addEventListener('keypress', (e) => {
  if (e.key === 'Enter') createWallet();
});

// Initial data load
loadStats();
loadBlocks();
loadWallets();

// Refresh intervals
setInterval(loadStats, 10000);
setInterval(loadBlocks, 30000);
</script>

</body>
</html>
