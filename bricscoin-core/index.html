<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>BricsCoin Core</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: system-ui; background: #0a0a0a; color: #fff; padding: 20px; }
    h1 { color: #ffd700; margin-bottom: 20px; }
    h2 { color: #ffd700; font-size: 16px; margin: 20px 0 10px; }
    .card { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 20px; margin-bottom: 20px; }
    .stats { display: grid; grid-template-columns: repeat(4, 1fr); gap: 15px; margin-bottom: 20px; }
    .stat { background: #222; padding: 15px; border-radius: 8px; text-align: center; }
    .stat .val { font-size: 24px; color: #ffd700; font-weight: bold; }
    .stat .lbl { font-size: 12px; color: #888; }
    input, select { width: 100%; padding: 10px; margin: 5px 0; background: #222; border: 1px solid #444; border-radius: 4px; color: #fff; }
    button { padding: 10px 20px; background: #ffd700; color: #000; border: none; border-radius: 4px; cursor: pointer; font-weight: bold; margin: 5px 0; }
    button:hover { background: #ffed4a; }
    button.stop { background: #ff4444; color: #fff; }
    .wallet { background: #222; padding: 15px; margin: 10px 0; border-radius: 8px; }
    .wallet .addr { font-family: monospace; color: #ffd700; font-size: 12px; word-break: break-all; }
    .wallet .seed { background: #331111; padding: 10px; margin-top: 10px; border-radius: 4px; font-size: 11px; font-family: monospace; }
    .wallet .bal { font-size: 20px; font-weight: bold; margin-top: 10px; }
    table { width: 100%; border-collapse: collapse; }
    th, td { padding: 10px; text-align: left; border-bottom: 1px solid #333; font-size: 13px; }
    th { color: #888; }
    .toast { position: fixed; bottom: 20px; right: 20px; background: #ffd700; color: #000; padding: 15px 25px; border-radius: 8px; display: none; }
    .tabs { display: flex; gap: 10px; margin-bottom: 20px; }
    .tab { padding: 10px 20px; background: #222; border-radius: 4px; cursor: pointer; }
    .tab.active { background: #ffd700; color: #000; }
    .page { display: none; }
    .page.active { display: block; }
    .mining-stats { display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px; margin: 15px 0; }
  </style>
</head>
<body>
  <h1>BRICSCOIN CORE</h1>
  
  <div class="stats">
    <div class="stat"><div class="val" id="s-supply">-</div><div class="lbl">Circulating</div></div>
    <div class="stat"><div class="val" id="s-blocks">-</div><div class="lbl">Blocks</div></div>
    <div class="stat"><div class="val" id="s-diff">-</div><div class="lbl">Difficulty</div></div>
    <div class="stat"><div class="val" id="s-reward">50</div><div class="lbl">Reward</div></div>
  </div>
  
  <div class="tabs">
    <div class="tab active" onclick="showPage('wallet')">Wallet</div>
    <div class="tab" onclick="showPage('mining')">Mining</div>
    <div class="tab" onclick="showPage('blocks')">Blocks</div>
  </div>
  
  <!-- WALLET PAGE -->
  <div id="wallet" class="page active">
    <div class="card">
      <h2>Create Wallet</h2>
      <input type="text" id="wallet-name" placeholder="Wallet name">
      <button onclick="createWallet()">Create New Wallet</button>
    </div>
    
    <div class="card">
      <h2>Your Wallets</h2>
      <div id="wallets"></div>
    </div>
    
    <div class="card">
      <h2>Send BRICS</h2>
      <select id="send-from"><option value="">Select wallet</option></select>
      <input type="text" id="send-to" placeholder="Recipient address">
      <input type="number" id="send-amount" placeholder="Amount">
      <button onclick="sendTx()">Send</button>
    </div>
  </div>
  
  <!-- MINING PAGE -->
  <div id="mining" class="page">
    <div class="card">
      <h2>Mining</h2>
      <select id="mine-wallet"><option value="">Select wallet</option></select>
      <div class="mining-stats">
        <div class="stat"><div class="val" id="m-hashrate">0</div><div class="lbl">H/s</div></div>
        <div class="stat"><div class="val" id="m-nonce">0</div><div class="lbl">Nonce</div></div>
        <div class="stat"><div class="val" id="m-found">0</div><div class="lbl">Found</div></div>
      </div>
      <p id="m-status" style="color:#888;margin:10px 0;">Ready</p>
      <button id="mine-btn" onclick="toggleMining()">Start Mining</button>
    </div>
  </div>
  
  <!-- BLOCKS PAGE -->
  <div id="blocks" class="page">
    <div class="card">
      <h2>Recent Blocks</h2>
      <table>
        <thead><tr><th>Height</th><th>Hash</th><th>Miner</th><th>Time</th></tr></thead>
        <tbody id="blocks-table"></tbody>
      </table>
    </div>
  </div>
  
  <div class="toast" id="toast"></div>
  
  <script>
    let mining = false;
    let found = 0;
    
    function showPage(id) {
      document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
      document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
      document.getElementById(id).classList.add('active');
      event.target.classList.add('active');
    }
    
    function toast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.style.display = 'block';
      setTimeout(() => t.style.display = 'none', 3000);
    }
    
    async function loadStats() {
      const s = await window.api.getStats();
      if (s) {
        document.getElementById('s-supply').textContent = (s.circulating_supply || 0).toLocaleString();
        document.getElementById('s-blocks').textContent = s.total_blocks || 0;
        document.getElementById('s-diff').textContent = s.current_difficulty || 0;
        document.getElementById('s-reward').textContent = s.current_reward || 50;
      }
    }
    
    async function loadBlocks() {
      const blocks = await window.api.getBlocks();
      const tbody = document.getElementById('blocks-table');
      tbody.innerHTML = blocks.map(b => `
        <tr>
          <td>#${b.index}</td>
          <td style="font-family:monospace">${(b.hash||'').substring(0,16)}...</td>
          <td style="font-family:monospace">${(b.miner||'').substring(0,12)}...</td>
          <td>${new Date(b.timestamp).toLocaleString()}</td>
        </tr>
      `).join('');
    }
    
    async function loadWallets() {
      const wallets = await window.api.getWallets();
      const div = document.getElementById('wallets');
      const sel1 = document.getElementById('send-from');
      const sel2 = document.getElementById('mine-wallet');
      
      sel1.innerHTML = '<option value="">Select wallet</option>';
      sel2.innerHTML = '<option value="">Select wallet</option>';
      
      if (wallets.length === 0) {
        div.innerHTML = '<p style="color:#888">No wallets. Create one above.</p>';
        return;
      }
      
      div.innerHTML = wallets.map(w => `
        <div class="wallet">
          <strong>${w.name}</strong>
          <div class="addr">${w.address}</div>
          <div class="seed">Seed: ${w.seedPhrase}</div>
          <div class="bal">${w.balance || 0} BRICS</div>
        </div>
      `).join('');
      
      wallets.forEach(w => {
        sel1.innerHTML += `<option value="${w.address}">${w.name}</option>`;
        sel2.innerHTML += `<option value="${w.address}">${w.name}</option>`;
      });
    }
    
    async function createWallet() {
      const name = document.getElementById('wallet-name').value || 'My Wallet';
      try {
        const w = await window.api.createWallet(name);
        toast('Wallet created: ' + w.address.substring(0, 15) + '...');
        document.getElementById('wallet-name').value = '';
        loadWallets();
      } catch (e) {
        toast('Error: ' + e.message);
      }
    }
    
    async function sendTx() {
      const from = document.getElementById('send-from').value;
      const to = document.getElementById('send-to').value;
      const amount = document.getElementById('send-amount').value;
      
      if (!from || !to || !amount) { toast('Fill all fields'); return; }
      
      try {
        await window.api.sendTx(from, to, parseFloat(amount));
        toast('Transaction sent!');
        document.getElementById('send-to').value = '';
        document.getElementById('send-amount').value = '';
        loadWallets();
      } catch (e) {
        toast('Error: ' + e.message);
      }
    }
    
    async function toggleMining() {
      const btn = document.getElementById('mine-btn');
      const addr = document.getElementById('mine-wallet').value;
      
      if (!mining) {
        if (!addr) { toast('Select wallet first'); return; }
        await window.api.startMining(addr);
        mining = true;
        btn.textContent = 'Stop Mining';
        btn.classList.add('stop');
        document.getElementById('m-status').textContent = 'Mining...';
      } else {
        await window.api.stopMining();
        mining = false;
        btn.textContent = 'Start Mining';
        btn.classList.remove('stop');
        document.getElementById('m-status').textContent = 'Stopped';
      }
    }
    
    window.api.onMiningInfo(d => {
      document.getElementById('m-status').textContent = `Mining block #${d.block} (diff: ${d.difficulty})`;
    });
    
    window.api.onMiningProgress(d => {
      document.getElementById('m-hashrate').textContent = d.hashrate.toLocaleString();
      document.getElementById('m-nonce').textContent = d.nonce.toLocaleString();
    });
    
    window.api.onBlockFound(d => {
      found++;
      document.getElementById('m-found').textContent = found;
      toast(`Block #${d.block} found! +${d.reward} BRICS`);
      loadStats();
      loadBlocks();
      loadWallets();
    });
    
    // Init
    loadStats();
    loadBlocks();
    loadWallets();
    setInterval(loadStats, 10000);
  </script>
</body>
</html>
