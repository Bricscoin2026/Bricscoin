<analysis>**original_problem_statement:** The user requested to create a Bitcoin-like cryptocurrency named BricsCoin. The project has since evolved into a full-stack application with a web and desktop wallet, hardware mining support, and deployment to a custom domain () on the user's Hetzner server.

**PRODUCT REQUIREMENTS:**
- **Blockchain Core:** Proof of Work (PoW) consensus with a Bitcoin-style difficulty system (retargeting every 2016 blocks), SHA256 hashing, 21,000,000 total supply, and a block reward halving mechanism.
- **Transactions:** A fee per transaction that is burned (removed from circulation) rather than given to the miner. Transactions must be signed client-side.
- **Mining:** Support for hardware ASIC miners via a Bitcoin-compliant Stratum protocol, accessible at .
- **Wallets:** A secure web wallet. A BricsCoin Core desktop wallet (for Windows, macOS, Linux).
- **Source Code & Transparency:** The project must be 100% open-source and publicly available on GitHub. The website must be transparent about the 1,000,000 BRICS premine and the fee-burning mechanism.
- **Credibility & Longevity:** The project must address red flags to appear legitimate. The difficulty adjustment must function correctly to ensure the coin's longevity (project must last 100 years).

**User's preferred language**: Italian

**what currently exists?**
A full-stack application (FastAPI backend, React frontend, MongoDB) is deployed on the user's Hetzner server () using Docker Compose and is accessible via . A Stratum server is running to support ASIC mining. However, the application is in a highly unstable state with several critical bugs related to core blockchain functions. The codebase is on a public GitHub repository.

**Last working item**:
- Last item agent was working: The agent was debugging why transactions are failing with a Signature verification failed error, as reported by the user with a screenshot. The investigation pointed towards a mismatch in the data being signed on the frontend () and the data being verified on the backend (). The agent was also trying to address the user's concern about not being able to add BricsCoin to MetaMask, explaining it's an independent blockchain.
- Status: IN PROGRESS
- Agent Testing Done: N
- Which testing method agent to use? The agent must fix the bug and then perform an end-to-end test by creating a transaction from the web wallet UI. This will validate both frontend signing and backend verification.
- User Testing Done: N

**All Pending/In progress Issue list**:
- Issue 1: Transactions are not working (P0)
- Issue 2: Blockchain difficulty is not adjusting automatically (P0)
- Issue 3: Wallet balances and circulating supply are calculated incorrectly (P1)
- Issue 4: Transaction fees are not being burned correctly (P2)
- Issue 5: Mining is not finding blocks at the expected rate (P2)

Issues Detail:
- Issue 1:
    - Attempted fixes: The agent has verified that the underlying API endpoint for importing wallets works, but sending a transaction fails. The error message Signature verification failed points to a mismatch between the client-side signing () and backend verification (). The agent has reviewed the code but has not yet implemented a definitive fix.
    - Next debug checklist:
        1. In  and , log the exact string message that is being signed and verified.
        2. Ensure the order of fields (, , , ) and their data types (especially ) are identical.
        3. Create a test transaction via the frontend and check the backend logs for the comparison failure.
    - Why fix this issue and what will be achieved with the fix?: This is a critical blockchain function. Without working transactions, the cryptocurrency has no utility.
    - Status: IN PROGRESS
    - Is recurring issue? Y
    - Should Test frontend/backend/both after fix? Both. The fix will likely be in both files. Testing must be E2E via the UI.
    - Blocked on other issue: None.

- Issue 2:
    - Attempted fixes: The user reported the difficulty is stuck at 1, which could exhaust the coin supply too quickly. The agent identified a bug where the difficulty adjustment logic (in ) was calculated but not being saved or enforced globally. A fix was attempted by creating a  file to persist the state. The stratum server was also modified to read this difficulty dynamically. However, the user still reports it's not working.
    - Next debug checklist:
        1. Verify that the  function is correctly called when a new block is added.
        2. Check if  is being written to and read from correctly by both  and .
        3. Ensure the logic for  is triggering correctly.
    - Why fix this issue and what will be achieved with the fix?: This is crucial for the long-term economic stability and security of the coin, as requested by the user.
    - Status: IN PROGRESS
    - Is recurring issue? Y
    - Should Test frontend/backend/both after fix? Backend. Verify via API and stratum logs.
    - Blocked on other issue: None.

- Issue 3:
    - Attempted fixes: The agent identified a double-counting bug where mining rewards were counted twice (once from the block's  field and once from the  transaction). A fix was implemented in the  function in  to only count non-coinbase transactions for the recipient. However, the user reports that balances are still wrong, and the circulating supply on the dashboard doesn't match the sum of wallet balances.
    - Next debug checklist:
        1. Re-examine the  and  functions in .
        2. Ensure that  transactions are correctly attributed to the miner's balance.
        3. The previous fix might be incorrect; the logic should be: .
    - Why fix this issue and what will be achieved with the fix?: Correct balances are fundamental for user trust and the basic functioning of a cryptocurrency wallet.
    - Status: IN PROGRESS
    - Is recurring issue? Y
    - Should Test frontend/backend/both after fix? Backend. Test via API calls.
    - Blocked on other issue: None.

- Issue 4:
    - Attempted fixes: The user requested that transaction fees be burned. The agent modified  to deduct the fee from the sender's balance but not add it to any recipient. The  API and  page were updated to reflect this for transparency.
    - Next debug checklist:
        1. After fixing transactions (Issue 1), send a transaction and verify that the sender's balance decreases by .
        2. Verify that the recipient's balance increases by  only.
        3. Check the  function to ensure burned fees are correctly subtracted from the total supply.
    - Why fix this issue and what will be achieved with the fix?: Fulfills a direct user requirement for the coin's economic model.
    - Status: TESTING PENDING
    - Is recurring issue? N
    - Should Test frontend/backend/both after fix? Backend.
    - Blocked on other issue: Issue 1: Transactions are not working

- Issue 5:
    - Attempted fixes: The user reported not finding blocks even with low difficulty. The agent discovered a major bug in the  constant in  and . The constant was set too low, requiring an extremely difficult hash (e.g., 8+ leading zeros) even for difficulty 1. The agent corrected  to a much higher value .
    - Next debug checklist:
        1. After deployment of the fix, monitor the stratum logs for BLOCK FOUND messages.
        2. Verify that the block count increases via the  endpoint.
    - Why fix this issue and what will be achieved with the fix?: Mining is the core of a PoW cryptocurrency. Without it, no new coins can be created or transactions confirmed.
    - Status: IN PROGRESS
    - Is recurring issue? Y
    - Should Test frontend/backend/both after fix? Backend.
    - Blocked on other issue: None.

**In progress Task List**:
- None.

**Upcoming and Future Tasks**
- **Future Tasks (Post-Launch):**
    - Pursue exchange listings.
    - Develop a mobile wallet for iOS/Android.
    - Create a dedicated page for community mining pools.
- **Removed from Roadmap:**
    - P2P node network
    - Community governance

**Completed work in this session**
- **Deployment & Server Management:** Guided the user through numerous complex deployments on their Hetzner server, resolving issues with usage: git [-v | --version] [-h | --help] [-C <path>] [-c <name>=<value>]
           [--exec-path[=<path>]] [--html-path] [--man-path] [--info-path]
           [-p | --paginate | -P | --no-pager] [--no-replace-objects] [--bare]
           [--git-dir=<path>] [--work-tree=<path>] [--namespace=<name>]
           [--super-prefix=<path>] [--config-env=<name>=<envvar>]
           <command> [<args>]

These are common Git commands used in various situations:

start a working area (see also: git help tutorial)
   clone     Clone a repository into a new directory
   init      Create an empty Git repository or reinitialize an existing one

work on the current change (see also: git help everyday)
   add       Add file contents to the index
   mv        Move or rename a file, a directory, or a symlink
   restore   Restore working tree files
   rm        Remove files from the working tree and from the index

examine the history and state (see also: git help revisions)
   bisect    Use binary search to find the commit that introduced a bug
   diff      Show changes between commits, commit and working tree, etc
   grep      Print lines matching a pattern
   log       Show commit logs
   show      Show various types of objects
   status    Show the working tree status

grow, mark and tweak your common history
   branch    List, create, or delete branches
   commit    Record changes to the repository
   merge     Join two or more development histories together
   rebase    Reapply commits on top of another base tip
   reset     Reset current HEAD to the specified state
   switch    Switch branches
   tag       Create, list, delete or verify a tag object signed with GPG

collaborate (see also: git help workflows)
   fetch     Download objects and refs from another repository
   pull      Fetch from and integrate with another repository or a local branch
   push      Update remote refs along with associated objects

'git help -a' and 'git help -g' list available subcommands and some
concept guides. See 'git help <command>' or 'git help <concept>'
to read about a specific subcommand or concept.
See 'git help git' for an overview of the system., , disk space, port conflicts, and environment variables.
- **SSL Configuration:** Successfully installed Certbot and configured Nginx to enable HTTPS on .
- **Genesis Wallet & Blockchain Reset:** Implemented a robust genesis wallet creation system and an admin endpoint to reset the blockchain for debugging purposes. Unified the wallet address generation logic between creation and import.
- **UI/UX Improvements:**
    - Implemented a Delete Wallet feature in the frontend wallet.
    - Removed the Future Updates section from the roadmap on the About page as requested.
- **Bug Fixes (In Progress):**
    - **Transaction Fees:** Updated backend and frontend to reflect that fees are burned.
    - **Mining Difficulty:** Corrected the  constant, which was preventing any blocks from being found.
    - **Wallet Balance:** Attempted to fix a double-counting bug in the balance calculation.

**Earlier issues found/mentioned but not fixed**
- All known issues are captured in the All Pending/In progress Issue list.

**Known issue recurrence from previous fork**
- **Hetzner Server Instability:** The user's server (2GB RAM) can be slow or crash during .
- **Deployment Complexity:** The user struggles with the multi-step deployment process. The current workaround involves ing the GitHub tarball instead of using .

**Code Architecture**


**Key Technical Concepts**
- **Bitcoin-style Difficulty:** Uses . The  value was recently corrected. The adjustment algorithm is still buggy.
- **Client-Side Transaction Signing:** The frontend signs transactions before sending them to the backend. This process is currently failing signature verification.
- **Fee Burning:** Fees are subtracted from the sender's balance and removed from the total circulating supply.
- **Stratum Protocol:** A Bitcoin-compliant server () allows hardware miners to connect.
- **Docker Deployment:** The application is containerized and managed via  on the user's production server.

**key DB schema**
- : 
- : 
- : 
- :  (persisted in )

**changes in tech stack**
- None.

**All files of reference**
- : Contains bugs related to transaction verification, balance calculation, and difficulty adjustment.
- : Contains bugs related to dynamic difficulty updates.
- : Contains the UI logic for sending transactions.
- : Contains the client-side signing logic which is part of the transaction bug.
- : Defines the production environment. Incorrect  has been a recurring issue.

**Areas that need refactoring**:
- The  function in  is fragile and has caused multiple bugs. It needs to be rewritten carefully to be correct and robust.
- The difficulty adjustment logic needs a complete review to ensure it is saved and applied correctly across the  and the .

**key api endpoints**
- : For sending transactions (failing verification).
- : Returns wallet balance (calculation is buggy).
- : Returns blockchain statistics (circulating supply is buggy).
- : Returns block information.
- : Resets the entire blockchain. **Should not be used unless absolutely necessary.**

**Critical Info for New Agent**
- **DO NOT RESET THE BLOCKCHAIN.** The user is frustrated with losing their mined blocks and getting new genesis wallets. All fixes must be applied to the existing, running blockchain on the Hetzner server.
- **Systematic Debugging Required:** The project has multiple, interconnected critical bugs. Address them in order of priority: Transactions -> Difficulty -> Balances. Do not move on until the previous one is fully fixed and verified.
- **Provide Clear Commands:** The user executes commands via SSH. Provide complete, copy-pasteable command blocks for deployment. Remember to include  after downloading code from GitHub.
- **The live server is .** All work must be deployed and verified there.

**documents and test reports created in this job**
-  (Outdated, created on preview environment before production bugs were found)

**Last 10 User Messages and any pending HUMAN messages**
1.  **User:** Reports transactions are failing with a signature verification failed error, and provides a screenshot. (PENDING)
2.  **User:** Asks if BricsCoin can be added to MetaMask. (COMPLETED - Agent explained it's not possible)
3.  **User:** Complains about the terminal closing and asks how to restart. (COMPLETED - Agent provided instructions)
4.  **User:** States that transaction fees must be burned and this should be transparent. (PENDING - Agent implemented a fix, but it needs verification).
5.  **User:** Reports a massive discrepancy between wallet balances and the circulating supply shown on the dashboard. (PENDING)
6.  **User:** States that the difficulty is not increasing as it should in Bitcoin, which will cause the coin supply to run out too quickly. (PENDING)
7.  **User:** Reports the downloaded macOS wallet from GitHub is damaged. (PENDING - Agent provided a workaround, needs user to test).
8.  **User:** After a blockchain reset, complains that the genesis wallet balance shows 0 again and wants a permanent fix for this recurring issue. (PENDING)
9.  **User:** Asks to lower the difficulty to 2 to speed up block finding for testing. (COMPLETED - Agent lowered it, but this revealed deeper bugs).
10. **User:** Reports that even with low difficulty, no blocks are being found, and suspects a problem with the mining logic. (PENDING - Agent has since fixed the  but other issues remain).

**Project Health Check:**
- **Broken:**
    - Transaction creation/sending
    - Automatic difficulty adjustment
    - Wallet balance and circulating supply calculation

**3rd Party Integrations**
- **Cloudflare:** DNS management.
- **GitHub & GitHub Actions:** Source control and automated desktop wallet builds.
- **Let's Encrypt (Certbot):** SSL certificate management for the production domain.

**Testing status**
- Testing agent used after significant changes: NO
- Troubleshoot agent used after agent stuck in loop: NO
- Test files created: []
- Known regressions: Wallet import functionality has been intermittently failing due to environment variable and backend issues.

**Credentials to test flow:**
- **Hetzner Server SSH:**
    - IP: 
    - User: 
    - Password: 

**What agent forgot to execute**
The agent has not forgotten tasks but is in the middle of a complex, multi-faceted debugging session. The primary oversight has been not holistically testing the impact of changes. For example, fixing one bug (like wallet import) often regressed or was affected by another (like incorrect  in the deployment). The next agent must be more systematic.</analysis>
